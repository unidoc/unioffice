//
// Copyright 2020 FoxyUtils ehf. All rights reserved.
//
// This is a commercial product and requires a license to operate.
// A trial license can be obtained at https://unidoc.io
//
// DO NOT EDIT: generated by unitwist Go source code obfuscator.
//
// Use of this source code is governed by the UniDoc End User License Agreement
// terms that can be accessed at https://unidoc.io/eula/

package testutils ;import (_g "archive/zip";_aa "bufio";_fadg "bytes";_fdc "crypto/md5";_cf "encoding/hex";_ed "encoding/json";_gb "encoding/xml";_a "errors";_dd "flag";_be "fmt";_da "github.com/stretchr/testify/require";_db "github.com/unidoc/unioffice/v2";
_edg "github.com/unidoc/unipdf/v4/common";_fe "golang.org/x/image/font";_ab "golang.org/x/image/font/opentype";_fda "golang.org/x/image/math/fixed";_ce "image";_d "image/color";_c "image/draw";_fad "image/png";_faa "io";_fd "io/ioutil";_cc "log";_fa "math";
_ac "os";_ec "os/exec";_df "path/filepath";_e "strings";_b "sync";_gc "testing";_fadc "time";);func (_aef *ReferenceFile )Update (currentMap *ReferenceMap )error {if _aef ._bee ==""{return nil ;};_fdaf :=_aef .updateMap (currentMap );if _fdaf ==0{return nil ;
};_afd ,_dbgb :=_ac .OpenFile (_aef ._bee ,_ac .O_CREATE |_ac .O_TRUNC |_ac .O_WRONLY ,0664);if _dbgb !=nil {return _dbgb ;};defer _afd .Close ();_aef .Timestamp =_fadc .Now ().UTC ();_afg :=_ed .NewEncoder (_afd );_afg .SetIndent ("","\u0009");return _afg .Encode (_aef );
};func CompareZip (t *_gc .T ,expectedFn string ,got []byte ,cmpFileContents bool ){_ge :=_df .Join ("\u0074\u0065\u0073\u0074\u0064\u0061\u0074\u0061",expectedFn );_dbg ,_bc :=_g .NewReader (_fadg .NewReader (got ),int64 (len (got )));if _bc !=nil {t .Fatalf ("\u0075\u006ea\u0062\u006c\u0065\u0020\u0074\u006f\u0020\u0072\u0065\u0061\u0064\u0020\u0074\u0065\u0073\u0074\u0020\u0069\u006e\u0070\u0075\u0074: \u0025\u0073",_bc );
};_ea ,_bc :=_ac .Open (_ge );if _bc !=nil {t .Fatalf ("\u0075\u006e\u0061\u0062\u006c\u0065\u0020\u0074\u006f\u0020r\u0065\u0061\u0064\u0020\u0067\u006f\u006cd\u0065\u006e\u0020\u0066\u0069\u006c\u0065\u003a\u0020\u0025\u0073",_bc );};defer _ea .Close ();
_cb ,_bc :=_ac .Stat (_ge );if _bc !=nil {t .Errorf ("\u0075\u006e\u0061bl\u0065\u0020\u0074\u006f\u0020\u0072\u0065\u0061\u0064\u0020\u0066\u0069\u006c\u0065\u003a\u0020\u0025\u0073",_bc );};_dfc ,_bc :=_g .NewReader (_ea ,_cb .Size ());if _bc !=nil {t .Errorf ("\u0075\u006e\u0061bl\u0065\u0020\u0074\u006f\u0020\u0072\u0065\u0061\u0064\u0020\u0066\u0069\u006c\u0065\u003a\u0020\u0025\u0073",_bc );
};t .Run (expectedFn ,_ceb (_dfc ,_dbg ,cmpFileContents ));};func (_eed *ReferenceMap )Write (key string ,entry ReferenceEntry ){_eed .Lock ();defer _eed .Unlock ();if _eed ._dc ==nil {_eed ._dc =map[string ]ReferenceEntry {};};_eed ._dc [key ]=entry ;
};func HashFile (file string )(string ,error ){_acd ,_ded :=_ac .Open (file );if _ded !=nil {return "",_ded ;};defer _acd .Close ();_fdeg :=_fdc .New ();if _ ,_ded =_faa .Copy (_fdeg ,_acd );_ded !=nil {return "",_ded ;};return _cf .EncodeToString (_fdeg .Sum (nil )),nil ;
};func _cbe (_fcca ,_cdde _ce .Rectangle )bool {return _fcca .Min .X ==_cdde .Min .X &&_fcca .Min .Y ==_cdde .Min .Y &&_fcca .Max .X ==_cdde .Max .X &&_fcca .Max .Y ==_cdde .Max .Y ;};func _bcf (_fdf ,_abe _d .Color )bool {_gca ,_adb ,_bbc ,_fga :=_fdf .RGBA ();
_fgaa ,_abd ,_cfb ,_bdd :=_abe .RGBA ();return _gca ==_fgaa &&_adb ==_abd &&_bbc ==_cfb &&_fga ==_bdd ;};func (_bcb *ReferenceMap )Read (key string )(ReferenceEntry ,bool ){_bcb .Lock ();defer _bcb .Unlock ();if _bcb ._dc ==nil {return ReferenceEntry {},false ;
};_gaf ,_ba :=_bcb ._dc [key ];return _gaf ,_ba ;};func CompareGoldenZipFilesOnly (t *_gc .T ,expectedFn string ,got []byte ){_bf :=_df .Join ("\u0074\u0065\u0073\u0074\u0064\u0061\u0074\u0061",expectedFn );if *_fg {if _fag :=_ac .WriteFile (_bf ,got ,0644);
_fag !=nil {t .Fatal (_fag );};};CompareZip (t ,expectedFn ,got ,false );};type ReferenceEntry struct{Timestamp int64 `json:"timestamp"`;Value string `json:"value"`;ResultSize int64 `json:"resultSize,omitempty"`;DiffPercent float64 `json:"diffPercent,omitempty"`;
DiffTotal float64 `json:"diffValue,omitempty"`;Invalid bool `json:"markedInvalid,omitempty"`;};func _ceb (_af ,_ecc *_g .Reader ,_cd bool )func (_gg *_gc .T ){return func (_eb *_gc .T ){_gd :=make ([]*_g .File ,len (_af .File ));copy (_gd ,_af .File );
_dbb :=make ([]*_g .File ,len (_ecc .File ));copy (_dbb ,_ecc .File );if len (_gd )!=len (_dbb ){_eb .Errorf ("\u0065x\u0070\u0065\u0063\u0074e\u0064\u0020\u0025\u0064\u0020f\u0069l\u0065s\u002c\u0020\u0067\u006f\u0074\u0020\u0025d",len (_af .File ),len (_ecc .File ));
};for _gga ,_geg :=range _gd {for _bb ,_dfcb :=range _dbb {if _dfcb ==nil {continue ;};if _geg .Name ==_dfcb .Name {if _cd {_eb .Run (_geg .Name ,_bef (_geg ,_dfcb ));};_gd [_gga ]=nil ;_dbb [_bb ]=nil ;};};};for _ ,_cfa :=range _gd {if _cfa !=nil {_eb .Errorf ("\u0064\u0069\u0064\u006e\u0027\u0074\u0020\u0066\u0069\u006ed\u0020\u0065\u0078\u0070\u0065\u0063\u0074e\u0064\u0020\u0066\u0069\u006c\u0065\u0020\u0027\u0025\u0073\u0027",_cfa .Name );
};};for _ ,_acb :=range _dbb {if _acb !=nil {_eb .Errorf ("\u0066\u006f\u0075\u006e\u0064\u0020\u0075\u006e\u0065\u0078\u0070e\u0063\u0074\u0065\u0064\u0020\u0066\u0069\u006c\u0065\u0020'\u0025\u0073\u0027",_acb .Name );};};};};func (_gbg *ReferenceMap )MarshalJSON ()([]byte ,error ){return _ed .Marshal (_gbg ._dc )};
func (_cae *ReferenceMap )Copy ()*ReferenceMap {_eeb :=ReferenceMap {_dc :make (map[string ]ReferenceEntry ,len (_cae ._dc ))};for _cag ,_bdbd :=range _cae ._dc {_eeb ._dc [_cag ]=_bdbd ;};return &_eeb ;};func (_cbb *ReferenceMap )UnmarshalJSON (data []byte )error {return _ed .Unmarshal (data ,&_cbb ._dc )};
func _fed (_bd string )error {_ef :=_db .XSDAny {};_bfe ,_cda :=_ac .Open (_bd );if _cda !=nil {return _cda ;};_ece :=_gb .NewDecoder (_bfe );if _cda =_ece .Decode (&_ef );_cda !=nil {return _cda ;};_bfe .Close ();_bfe ,_cda =_ac .Create (_bd );if _cda !=nil {return _cda ;
};defer _bfe .Close ();_deg :=_gb .NewEncoder (_bfe );_deg .Indent ("","\u0020\u0020");return _deg .Encode (&_ef );};func _aab (_eee string )string {_de ,_ :=_ac .CreateTemp ("",_eee );defer _de .Close ();return _de .Name ();};func CombinePNGFiles (file1 ,file2 string )(bool ,error ){_fbb ,_cdd :=ReadPNG (file1 );
if _cdd !=nil {return false ,_cdd ;};_acg ,_cdd :=ReadPNG (file2 );if _cdd !=nil {return false ,_cdd ;};_cfe :=_ce .Point {_fbb .Bounds ().Dx (),0};_gaff :=_ce .Rectangle {_cfe ,_cfe .Add (_acg .Bounds ().Size ())};_ccbf :=_ce .Rectangle {_ce .Point {0,0},_gaff .Max };
_bgf :=_ce .NewRGBA (_ccbf );_c .Draw (_bgf ,_fbb .Bounds (),_fbb ,_ce .Point {0,0},_c .Src );_c .Draw (_bgf ,_gaff ,_acg ,_ce .Point {0,0},_c .Src );_fff :=_df .Dir (file1 );_fcg :=_e .TrimSuffix (_df .Base (file1 ),_df .Ext (file1 ));_dge ,_cdd :=_ac .Create (_fff +"\u002f"+_fcg +"\u002d\u0063\u006f\u006d\u0062\u0069\u006e\u0065\u0064\u002e\u0070\u006e\u0067");
if _cdd !=nil {return false ,_cdd ;};defer _dge .Close ();if _ebd :=_fad .Encode (_dge ,_bgf );_ebd !=nil {return false ,_ebd ;};return true ,nil ;};func _cef (_bfb *_gc .T ,_bg ,_ff []byte ){_bce :=_aab ("\u0065\u0078\u0070\u0065\u0063\u0074\u0065\u0064");
_ac .WriteFile (_bce ,_bg ,0644);_ecb :=_aab ("\u0067\u006f\u0074");_ac .WriteFile (_ecb ,_ff ,0644);defer func (){_ac .Remove (_bce );_ac .Remove (_ecb )}();_fed (_bce );_fed (_ecb );_ccb :=_ec .Command ("\u0064\u0069\u0066\u0066","\u002d\u0075",_bce ,_ecb );
_gf ,_ae :=_ccb .StdoutPipe ();if _ae !=nil {_bfb .Fatalf ("e\u0072\u0072\u006f\u0072\u0020\u0072u\u006e\u006e\u0069\u006e\u0067\u0020\u0078\u006d\u006ci\u006e\u0064\u0065n\u0074:\u0020\u0025\u0073",_ae );};defer _gf .Close ();_gcb ,_ae :=_ccb .StderrPipe ();
if _ae !=nil {_bfb .Fatalf ("e\u0072\u0072\u006f\u0072\u0020\u0072u\u006e\u006e\u0069\u006e\u0067\u0020\u0078\u006d\u006ci\u006e\u0064\u0065n\u0074:\u0020\u0025\u0073",_ae );};defer _gcb .Close ();if _gfg :=_ccb .Start ();_gfg !=nil {_bfb .Fatalf ("\u0065\u0072\u0072\u006f\u0072\u0020\u0073\u0074\u0072\u0069\u006eg\u0020\u0078\u006d\u006c\u0069\u006e\u0064\u0065\u006e\u0074:\u0020\u0025\u0073",_gfg );
};_ceae :=_aa .NewScanner (_gf );for _ceae .Scan (){_cc .Println (_ceae .Text ());};if _dec :=_ccb .Wait ();_dec !=nil {_gcd ,_ :=_faa .ReadAll (_gcb );_bfb .Fatalf ("e\u0072\u0072\u006f\u0072\u0020\u0077a\u0069\u0074\u0069\u006e\u0067\u0020o\u006e\u0020\u0078\u006d\u006c\u0069\u006ed\u0065\u006e\u0074\u003a\u0020\u0025\u0073\u0020\u005b\u0025s\u005d",string (_gcd ),_dec );
};};var (ErrRenderNotSupported =_a .New ("\u0072\u0065\u006e\u0064\u0065r\u0069\u006e\u0067\u0020\u0050\u0044\u0046\u0020\u0066\u0069\u006c\u0065\u0073 \u0069\u0073\u0020\u006e\u006f\u0074\u0020\u0073\u0075\u0070\u0070\u006f\u0072\u0074\u0065\u0064\u0020\u006f\u006e\u0020\u0074\u0068\u0069\u0073\u0020\u0073\u0079\u0073\u0074\u0065m");
ErrImageSizeNotMatch =_a .New ("\u0069\u006d\u0061ge\u0020\u0073\u0069\u007a\u0065\u0073\u0020\u0064\u006f\u006e\u0027\u0074\u0020\u006d\u0061\u0074\u0063\u0068"););func RunRenderTest (t *_gc .T ,pdfPath ,outputDir ,baselineRenderPath string ,saveBaseline bool ,currentHashMap *ReferenceMap ,refFile *ReferenceFile ){RunRenderOfficeTest (t ,pdfPath ,outputDir ,baselineRenderPath ,saveBaseline ,currentHashMap ,refFile ,"\u002em\u0073\u0077\u006f\u0072\u0064");
};func CompareImages (img1 ,img2 _ce .Image )(bool ,error ){_eba :=img1 .Bounds ();_gfa :=0;for _aed :=0;_aed < _eba .Size ().X ;_aed ++{for _efg :=0;_efg < _eba .Size ().Y ;_efg ++{_cce ,_caeg ,_acf ,_ :=img1 .At (_aed ,_efg ).RGBA ();_dbee ,_eca ,_gad ,_ :=img2 .At (_aed ,_efg ).RGBA ();
if _cce !=_dbee ||_caeg !=_eca ||_acf !=_gad {_gfa ++;};};};_bcaf :=float64 (_gfa )/float64 (_eba .Dx ()*_eba .Dy ());if _bcaf > 0.0001{_be .Printf ("\u0064\u0069\u0066f \u0066\u0072\u0061\u0063\u0074\u0069\u006f\u006e\u003a\u0020\u0025\u0076\u0020\u0028\u0025\u0064\u0029\u000a",_bcaf ,_gfa );
return false ,nil ;};return true ,nil ;};func (_ege *ReferenceMap )Len ()int {return len (_ege ._dc )};func CompareGoldenXML (t *_gc .T ,expectedFn string ,got []byte ){_fc :=_df .Join ("\u0074\u0065\u0073\u0074\u0064\u0061\u0074\u0061",expectedFn );if *_fg {if _edgf :=_ac .WriteFile (_fc ,got ,0644);
_edgf !=nil {t .Fatal (_edgf );};};_fgg ,_cg :=_ac .ReadFile (_fc );if _cg !=nil {t .Fatalf ("\u0075\u006e\u0061\u0062\u006c\u0065 \u0074\u006f\u0020\u0072\u0065\u0061\u0064\u0020\u0065\u0078\u0070\u0065\u0063t\u0065\u0064\u0020\u0069\u006e\u0070\u0075t\u003a\u0020\u0025\u0073",_cg );
};_cef (t ,_fgg ,got );};func ComparePNGFiles (file1 ,file2 string )(bool ,error ){_abb ,_gfac :=HashFile (file1 );if _gfac !=nil {return false ,_gfac ;};_fdb ,_gfac :=HashFile (file2 );if _gfac !=nil {return false ,_gfac ;};if _abb ==_fdb {return true ,nil ;
};_eda ,_gfac :=ReadPNG (file1 );if _gfac !=nil {return false ,_gfac ;};_gff ,_gfac :=ReadPNG (file2 );if _gfac !=nil {return false ,_gfac ;};if _eda .Bounds ()!=_gff .Bounds (){return false ,nil ;};return CompareImages (_eda ,_gff );};func ReadPNG (file string )(_ce .Image ,error ){_cbc ,_fgc :=_ac .Open (file );
if _fgc !=nil {return nil ,_fgc ;};defer _cbc .Close ();return _fad .Decode (_cbc );};func _fae (_gegb *_gc .T ,_fdcg string )int64 {_efeg ,_cee :=_ac .Stat (_fdcg );_da .NoError (_gegb ,_cee );return _efeg .Size ();};func _gdb (_cgg *_ce .RGBA ,_aaa string ,_edc string ,_cde ,_gcf int )error {_gdc ,_edag :=_fd .ReadFile (_aaa );
if _edag !=nil {return _edag ;};_eafc ,_edag :=_ab .Parse (_gdc );if _edag !=nil {return _edag ;};_cbcd ,_edag :=_ab .NewFace (_eafc ,&_ab .FaceOptions {Size :18,DPI :72,Hinting :_fe .HintingNone });if _edag !=nil {return _edag ;};_dba :=&_fe .Drawer {Dst :_cgg ,Src :_ce .NewUniform (_d .RGBA {200,100,0,255}),Face :_cbcd ,Dot :_fda .P (_cde ,_gcf )};
_dba .DrawString (_edc );return nil ;};func RenderPDFToPNGs (pdfPath string ,dpi int ,outpathTpl string )error {if dpi <=0{dpi =100;};if _ ,_gab :=_ec .LookPath ("\u0067\u0073");_gab !=nil {return ErrRenderNotSupported ;};return _ec .Command ("\u0067\u0073","\u002d\u0073\u0044\u0045\u0056\u0049\u0043\u0045\u003d\u0070\u006e\u0067a\u006c\u0070\u0068\u0061","\u002d\u006f",outpathTpl ,_be .Sprintf ("\u002d\u0072\u0025\u0064",dpi ),pdfPath ).Run ();
};type ReferenceFile struct{Timestamp _fadc .Time `json:"timestamp"`;Map *ReferenceMap `json:"map,omitempty"`;_bee string ;};type ReferenceMap struct{_b .Mutex ;_dc map[string ]ReferenceEntry ;};func CopyFile (src ,dst string )error {_ebc ,_aabc :=_ac .Open (src );
if _aabc !=nil {return _aabc ;};defer _ebc .Close ();_ffc ,_aabc :=_ac .Create (dst );if _aabc !=nil {return _aabc ;};defer _ffc .Close ();_ ,_aabc =_faa .Copy (_ffc ,_ebc );return _aabc ;};type ValidationResult struct{File string `json:"file"`;Result bool `json:"result"`;
Note string `json:"note"`;};func ReadFile (dirPath ,testName string ,createEmpty bool )(*ReferenceFile ,error ){if dirPath ==""&&createEmpty {return &ReferenceFile {Map :&ReferenceMap {}},nil ;};if dirPath ==""{return nil ,_ac .ErrNotExist ;};_dfcc :=_df .Join (dirPath ,testName +"\u005fr\u0065f\u0065\u0072\u0065\u006e\u0063\u0065\u002e\u006a\u0073\u006f\u006e");
_dad :=&ReferenceFile {_bee :_dfcc };_baa ,_ega :=_ac .Open (_dfcc );if _a .Is (_ega ,_ac .ErrNotExist )&&createEmpty {_dad .Timestamp =_fadc .Now ().UTC ();_dad .Map =&ReferenceMap {};return _dad ,nil ;};if _ega !=nil {return nil ,_ega ;};defer _baa .Close ();
if _ecbc :=_ed .NewDecoder (_baa ).Decode (_dad );_ecbc !=nil {if _ecbc .Error ()=="i\u006c\u006c\u0065\u0067\u0061\u006c \u0062\u0061\u0073\u0065\u0036\u0034 \u0064\u0061\u0074\u0061\u0020\u0061\u0074 \u0069\u006e\u0070\u0075\u0074\u0020\u0062\u0079\u0074\u0065 \u0030"&&createEmpty {return _dad ,nil ;
};return nil ,_ecbc ;};return _dad ,nil ;};var _fg =_dd .Bool ("t\u0065\u0073\u0074\u002e\u0075\u0070\u0064\u0061\u0074\u0065",false ,"\u0075p\u0064a\u0074\u0065\u0020\u0067\u006fl\u0064\u0065n\u0020\u0066\u0069\u006c\u0065");func _bad (_decf ,_gaa string )error {_cec ,_ecbd :=_ac .Open (_decf );
if _ecbd !=nil {return _ecbd ;};defer _cec .Close ();_ggf ,_ ,_ecbd :=_ce .DecodeConfig (_cec );if _ecbd !=nil {panic (_ecbd );};_efe :=_ce .NewRGBA (_ce .Rect (0,0,_ggf .Width ,_ggf .Height ));_caed ,_ecbd :=_ac .Create (_gaa );if _ecbd !=nil {return _ecbd ;
};defer _caed .Close ();_ecbd =_fad .Encode (_caed ,_efe );if _ecbd !=nil {return _ecbd ;};return nil ;};func _bef (_fde ,_fb *_g .File )func (_eg *_gc .T ){return func (_cca *_gc .T ){_cea ,_afc :=_fde .Open ();if _afc !=nil {_cca .Errorf ("\u0065\u0072r\u006f\u0072\u0020o\u0070\u0065\u006e\u0069\u006e\u0067\u0020\u0025\u0073",_fde .Name );
};defer _cea .Close ();_cbf ,_afc :=_fb .Open ();if _afc !=nil {_cca .Errorf ("\u0065\u0072r\u006f\u0072\u0020o\u0070\u0065\u006e\u0069\u006e\u0067\u0020\u0025\u0073",_fb .Name );};defer _cbf .Close ();_bca ,_ :=_faa .ReadAll (_cea );_dbe ,_ :=_faa .ReadAll (_cbf );
if !_fadg .Equal (_bca ,_dbe ){_cef (_cca ,_bca ,_dbe );_be .Println (string (_bca ));_be .Println (string (_dbe ));_cca .Errorf ("\u006d\u0069\u0073\u006da\u0074\u0063\u0068\u0065\u0064\u0020\u0063\u006f\u006e\u0074e\u006et\u0073\u0020\u0025\u0064\u0020\u0076\u0073 \u0025\u0064",len (_bca ),len (_dbe ));
};};};func (_fee *ReferenceFile )updateMap (_ggad *ReferenceMap )int {var _ag int ;if _fee .Map ._dc ==nil {_fee .Map ._dc =map[string ]ReferenceEntry {};};for _gda ,_cge :=range _ggad ._dc {_eec ,_edge :=_fee .Map ._dc [_gda ];if !_edge {_fee .Map ._dc [_gda ]=_cge ;
_ag ++;continue ;};if string (_eec .Value )!=string (_cge .Value ){_fee .Map ._dc [_gda ]=_cge ;_ag ++;};};for _eaf :=range _fee .Map ._dc {if _ ,_eeg :=_ggad ._dc [_eaf ];!_eeg {delete (_fee .Map ._dc ,_eaf );_ag ++;};};return _ag ;};func ValidateDocument (file string )(bool ,error ){var (_bba =_ac .Getenv ("\u0050\u0052\u004fJ\u0045\u0043\u0054\u005f\u0052\u004f\u004f\u0054");
_egb =_ac .Getenv ("\u0048\u004f\u004d\u0045")+"\u002f\u0064\u006f\u0074\u006e\u0065\u0074\u002f\u0064o\u0074\u006e\u0065\u0074";_fbd =_bba +"\u002f\u002e\u0063\u0069\u002f\u006f\u0070\u0065\u006e\u0078\u006d\u006c\u002d\u0076\u0061l\u0069\u0064\u0061\u0074\u006f\u0072\u002f\u0062\u0069\u006e\u002f\u0052\u0065l\u0065\u0061\u0073\u0065\u002f\u006e\u0065\u0074\u0031\u0030\u002e\u0030/P\u0072\u006f\u0067\u0072\u0061\u006d\u002e\u0064\u006c\u006c";
_gbe =_bba +"\u002f\u0069\u006et\u0065\u0072\u006e\u0061\u006c\u002f\u0074\u0065\u0073\u0074\u0075\u0074\u0069\u006c\u0073\u002f\u0076\u0061\u006c\u0069\u0064\u0061\u0074\u0069\u006f\u006e\u005f\u0072\u0065s\u0075\u006c\u0074\u002e\u006a\u0073\u006f\u006e";
_afe _fadg .Buffer ;_caf string ;_eaa =true ;);if _ ,_egg :=_ac .Stat (_egb );_egg !=nil {_edg .Log .Debug ("\u0064\u006f\u0074\u006e\u0065\u0074 \u0065\u0078\u0065\u0063\u0075\u0074\u0061\u0062\u006c\u0065\u0020\u006e\u006ft\u0020\u0066\u006f\u0075\u006e\u0064\u0020i\u006e\u0020\u0025\u0073",_egb );
return true ,nil ;};if _ ,_ccgd :=_ac .Stat (_fbd );_ccgd !=nil {_edg .Log .Debug ("\u006f\u0070\u0065\u006e\u0078\u006dl\u002d\u0076\u0061\u006c\u0069\u0064\u0061\u0074\u006f\u0072\u0020\u006e\u006ft\u0020\u0066\u006f\u0075\u006e\u0064\u0020i\u006e\u0020\u0025\u0073",_fbd );
return true ,nil ;};var (_ebce map[string ]map[string ]*ValidationResult ;_cfd *ValidationResult ;);_dfee ,_fgfd :=_ac .ReadFile (_gbe );if _fgfd !=nil {return false ,_fgfd ;};if _bggf :=_ed .Unmarshal (_dfee ,&_ebce );_bggf !=nil {return false ,_bggf ;
};if _ebce ==nil {_ebce =make (map[string ]map[string ]*ValidationResult );};_gcc :=_df .Ext (file );_gcc =_gcc [1:];if _gcc !="\u0064\u006f\u0063\u0078"&&_gcc !="\u0078\u006c\u0073\u0078"&&_gcc !="\u0070\u0070\u0074\u0078"{return false ,_be .Errorf ("\u0075\u006e\u0073\u0075\u0070\u0070\u006f\u0072\u0074\u0065d\u0020\u0066\u0069\u006c\u0065\u0020\u0065x\u0074\u0065\u006e\u0073\u0069\u006f\u006e\u003a\u0020\u0025\u0073",_gcc );
};_fgad :=_df .Base (file );if _cdc ,_fab :=_ebce [_gcc ];_fab {if _dbc ,_edgg :=_cdc [_fgad ];_edgg {_cfd =_dbc ;};};_ebf :=_ec .Command (_egb ,_fbd ,"\u002d\u002d"+_gcc ,file );_ebf .Stderr =&_afe ;_abeb ,_fgfd :=_ebf .Output ();if _fgfd !=nil {_caf =_afe .String ();
};_gdbg :=string (_abeb );_gdbg =_e .TrimSpace (_gdbg [_e .Index (_gdbg ,"\u000a")+1:]);if _e .Contains (_gdbg ,"\u0045x\u0063\u0065\u0070\u0074\u0069\u006fn")||_e .Contains (_gdbg ,"\u0069\u0073\u0020n\u006f\u0074\u0020\u0076\u0061\u006c\u0069\u0064"){_eaa =false ;
if _e .Contains (_gdbg ,"\u006da\u0069\u006e\u003a\u0073\u007a")||_e .Contains (_gdbg ,"m\u0061\u0069\u006e\u003a\u0066\u0061\u006d\u0069\u006c\u0079")||_e .Contains (_gdbg ,"\u0063h\u0061\u0072\u0074\u003a\u0065\u0078t"){_caf ="\u0046\u0061\u0069\u006c\u0065\u0064\u0020\u0076\u0061\u006ci\u0064\u0061\u0074\u0069\u006f\u006e\u0020i\u0073\u0020\u0069\u0067\u006e\u006f\u0072\u0065\u0064\u003a\u0020"+_gdbg ;
_eaa =true ;};};if _caf ==""{_caf =_gdbg ;};if _cfd ==nil {_cfd =&ValidationResult {File :_fgad ,Result :_eaa ,Note :_caf };};_cfd .Result =_eaa ;_cfd .Note =_caf ;if _ebce [_gcc ]==nil {_ebce [_gcc ]=make (map[string ]*ValidationResult );};if _fcbg ,_faae :=_ebce [_gcc ][_fgad ];
_faae {if _fcbg .Result &&!_eaa {return false ,_be .Errorf ("v\u0061\u006c\u0069\u0064\u0061\u0074\u0069\u006f\u006e \u0072\u0065\u0073\u0075\u006c\u0074\u0020ch\u0061\u006e\u0067\u0065d\u0020\u0066\u006f\u0072\u0020\u0025\u0073\u003a\u0020%v\u0020\u002d>\u0020\u0025\u0076\u0020\u0028\u0025\u0073\u0029",file ,_fcbg .Result ,_eaa ,_caf );
};};_ebce [_gcc ][_fgad ]=_cfd ;_dfee ,_fgfd =_ed .MarshalIndent (_ebce ,"","\u0020\u0020");if _fgfd !=nil {return false ,_fgfd ;};if _feda :=_ac .WriteFile (_gbe ,_dfee ,0644);_feda !=nil {return false ,_feda ;};return true ,nil ;};func CreatePNGDiff (src ,dst string )(bool ,string ,float64 ,float64 ,error ){_acbd ,_ad :=ReadPNG (src );
if _ad !=nil {return false ,"",0,0,_ad ;};_ceg ,_ad :=ReadPNG (dst );if _ad !=nil {return false ,"",0,0,_ad ;};_dece :=_acbd .Bounds ();_gba :=_ceg .Bounds ();if !_cbe (_dece ,_gba ){if _fa .Abs (float64 (_dece .Max .X )-float64 (_gba .Max .X ))> 1{_cc .Printf ("S\u006f\u0075\u0072\u0063\u0065\u0020b\u006f\u0075\u006e\u0064\u0073\u003a \u0025\u0076\u003b\u0020\u0044\u0065\u0073t\u0020\u0062\u006f\u0075\u006e\u0064\u0073\u003a\u0020\u0025v\u000a",_dece ,_gba );
return false ,"",0,0,ErrImageSizeNotMatch ;};};_eceg :=_ce .NewRGBA (_ce .Rect (0,0,_dece .Max .X ,_dece .Max .Y ));var (_gadc float64 ;_gfb float64 ;);for _ebe :=_dece .Min .Y ;_ebe < _dece .Max .Y ;_ebe ++{for _ccg :=_dece .Min .X ;_ccg < _dece .Max .X ;
_ccg ++{_fcgd ,_beeb ,_bec ,_fcb :=_acbd .At (_ccg ,_ebe ).RGBA ();_cbbb ,_ecega ,_egf ,_ddg :=_ceg .At (_ccg ,_ebe ).RGBA ();_eceg .Set (_ccg ,_ebe ,_d .RGBA {uint8 (_cbbb ),uint8 (_ecega ),uint8 (_egf ),64});_egag :=_fcb ==0x00&&_fcgd ==0x00&&_beeb ==0x00&&_bec ==0x00&&_cbbb ==0xFFFF&&_ecega ==0xFFFF&&_egf ==0xFFFF;
if !_egag &&!_bcf (_acbd .At (_ccg ,_ebe ),_ceg .At (_ccg ,_ebe )){_eceg .Set (_ccg ,_ebe ,_d .RGBA {uint8 (_fcgd ),uint8 (_beeb ),uint8 (_bec ),uint8 (_fcb )});_dee :=float64 (_fcgd )+float64 (_beeb )+float64 (_bec )+float64 (_fcb )-float64 (_cbbb )+float64 (_ecega )+float64 (_egf )+float64 (_ddg );
_ddca :=_fa .Sqrt (_fa .Pow (_dee /float64 (_dece .Dx ()*_dece .Dy ()),2));_gfb +=_ddca ;_gadc ++;};};};_dde :=_gadc /float64 (_dece .Dx ()*_dece .Dy ())*100;_aabd :=_df .Dir (src );_ged :=_e .TrimSuffix (_df .Base (src ),_df .Ext (src ));_cbbg ,_ad :=_ac .Create (_aabd +"\u002f"+_ged +"\u002dd\u0069\u0066\u0066\u002e\u0070\u006eg");
if _ad !=nil {return false ,"",0,0,_ad ;};defer _cbbg .Close ();_aad :=_e .Replace (_aabd ,"\u0072\u0065\u006e\u0064\u0065\u0072","\u0066\u006f\u006et\u0073",1)+"\u002f\u0043\u0061l\u0069\u0062\u0072\u0069\u002e\u0074\u0074\u0066";_bceg :=_be .Sprintf ("\u0044\u0069f\u0066\u0065\u0072e\u006e\u0063\u0065\u003a\u0020\u0025\u0066\u0025\u0025",_dde );
_ad =_gdb (_eceg ,_aad ,_bceg ,15,22);if _ad !=nil {return false ,"",0,0,_ad ;};_bceg =_be .Sprintf ("T\u006ft\u0061\u006c\u0020\u0044\u0069\u0066\u0066\u0065r\u0065\u006e\u0063\u0065: \u0025\u0066",_gfb );_ad =_gdb (_eceg ,_aad ,_bceg ,15,44);if _ad !=nil {return false ,"",0,0,_ad ;
};if _fdge :=_fad .Encode (_cbbg ,_eceg );_fdge !=nil {return false ,"",0,0,_fdge ;};return true ,_cbbg .Name (),_dde ,_gfb ,nil ;};func RunRenderOfficeTest (t *_gc .T ,pdfPath ,outputDir ,baselineRenderPath string ,saveBaseline bool ,currentHashMap *ReferenceMap ,refFile *ReferenceFile ,postfix string ){_dfa :=_e .TrimSuffix (_df .Base (pdfPath ),_df .Ext (pdfPath ));
t .Run ("\u0072\u0065\u006e\u0064\u0065\u0072",func (_bgg *_gc .T ){_gfe :=_df .Join (outputDir ,_dfa );_bcg :=_gfe +"\u002d%\u0064\u002e\u0070\u006e\u0067";if _dce :=RenderPDFToPNGs (pdfPath ,0,_bcg );_dce !=nil {_bgg .Skip (_dce );};_fada :=_dfa +postfix ;
_bag :=_df .Join (outputDir ,_fada );_ccbb :=_bag +"\u002d%\u0064\u002e\u0070\u006e\u0067";_ace :=false ;if saveBaseline {_gdce :=_df .Dir (pdfPath );_fdac :=_df .Join (_gdce ,_fada +"\u002e\u0070\u0064\u0066");if _ ,_gdcb :=_ac .Stat (_fdac );_gdcb ==nil {_bgg .Logf ("\u0052e\u006e\u0064\u0065\u0072\u0020\u004d\u0053\u0020\u004f\u0066\u0066i\u0063\u0065\u0020\u0050\u0044\u0046\u003a\u0020\u0025\u0076",_fdac );
if _fdcd :=RenderPDFToPNGs (_fdac ,0,_ccbb );_fdcd !=nil {_bgg .Skip (_fdcd );};_ace =true ;};};for _beec :=1;true ;_beec ++{_cead :=_be .Sprintf ("\u0025s\u002d\u0025\u0064\u002e\u0070\u006eg",_gfe ,_beec );_bae :=_df .Join (baselineRenderPath ,_be .Sprintf ("\u0025\u0073\u002d\u0025\u0064\u005f\u0065\u0078\u0070\u002e\u0070\u006e\u0067",_dfa ,_beec ));
if _ ,_ddf :=_ac .Stat (_cead );_ddf !=nil {break ;};_bgg .Logf ("\u0025\u0073",_bae );if saveBaseline {_bgg .Logf ("\u0043\u006fp\u0079\u0069\u006eg\u0020\u0025\u0073\u0020\u002d\u003e\u0020\u0025\u0073",_cead ,_bae );_dgb :=CopyFile (_cead ,_bae );if _dgb !=nil {_bgg .Fatalf ("\u0045\u0052\u0052OR\u0020\u0063\u006f\u0070\u0079\u0069\u006e\u0067\u0020\u0074\u006f\u0020\u0025\u0073\u003a\u0020\u0025\u0076",_bae ,_dgb );
};if _ace {_cgd :=_be .Sprintf ("\u0025s\u002d\u0025\u0064\u002e\u0070\u006eg",_bag ,_beec );_dgf :=_df .Join (baselineRenderPath ,_be .Sprintf ("\u0025\u0073\u002d\u0025\u0064\u005f\u0065\u0078\u0070\u002e\u0070\u006e\u0067",_fada ,_beec ));_bgg .Logf ("\u0043\u006f\u0070\u0079\u0069\u006e\u0067\u0020\u004d\u0053\u0020\u0057\u006f\u0072\u0064 \u0072e\u0073\u0075\u006c\u0074\u0073\u0020\u0025\u0073\u0020\u002d\u003e\u0020\u0025\u0073",_cgd ,_dgf );
_eeef :=CopyFile (_cgd ,_dgf );if _eeef !=nil {_bgg .Logf ("\u0045\u0052\u0052\u004f\u0052\u0020\u0063\u006f\u0070\u0079\u0069\u006eg\u0020\u0074\u006f \u0025\u0073\u003a\u0020\u0025\u0076\u002c\u0020\u0068\u0061\u0076i\u006e\u0067\u0020d\u0069\u0066\u0066\u0065r\u0065\u006e\u0074\u0020\u0070\u0061\u0067\u0065\u0020\u0073\u0069\u007a\u0065\u0020\u0072\u0065\u0073\u0075\u006c\u0074\u0073\u002c\u0020\u0072\u0065\u0070\u006c\u0061\u0063\u0069\u006eg\u0020\u0069\u0074\u0020\u0077\u0069\u0074\u0068\u0020\u0062\u006ca\u006e\u006b\u0020\u0069\u006d\u0061\u0067\u0065\u0020\u0069\u006e\u0073\u0074\u0065\u0061\u0064",_dgf ,_eeef );
if _dfe :=_bad (_bae ,_dgf );_dfe !=nil {_bgg .Fatalf ("\u0045\u0052\u0052\u004f\u0052\u0020c\u0072\u0065\u0061\u0074\u0069\u006e\u0067\u0020\u0065\u006d\u0070\u0074\u0079 \u0069\u006d\u0061\u0067\u0065\u0020\u0025s\u003a\u0020\u0025\u0076",_dgf ,_dfe );
};};_bgg .Logf ("\u0043\u006fm\u0062\u0069\u006e\u0069\u006eg\u0020\u0055\u006e\u0069\u004ff\u0066\u0069\u0063\u0065\u0020\u0072\u0065\u0073\u0075\u006c\u0074\u0073\u0020\u0077\u0069\u0074\u0068\u0020\u004d\u0053\u0020\u004f\u0066\u0066\u0069\u0063\u0065\u0020\u0025\u0073\u0020\u0061\u006e\u0064\u0020\u0025\u0073",_bae ,_dgf );
_afa ,_eeef :=CombinePNGFiles (_bae ,_dgf );if _ac .IsNotExist (_eeef ){_bgg .Fatal ("\u0069m\u0061g\u0065\u0020\u0066\u0069\u006ce\u0020\u006di\u0073\u0073\u0069\u006e\u0067");}else if !_afa {_bgg .Fatal ("\u0055n\u0061\u0062\u006c\u0065\u0020\u0074\u006f\u0020\u0063\u006f\u006db\u0069\u006e\u0065\u0020\u0069\u006d\u0061\u0067\u0065\u0073");
};_bgg .Logf ("\u0043\u0072\u0065\u0061\u0074\u0069\u006e\u0067\u0020\u0069\u006d\u0061\u0067\u0065\u0020\u0064\u0069\u0066f \u0055n\u0069\u004f\u0066\u0066\u0069\u0063\u0065\u0020\u0072\u0065\u0073\u0075l\u0074\u0073\u0020\u0077\u0069\u0074\u0068\u0020\u004d\u0053\u0020\u004f\u0066\u0066\u0069\u0063\u0065 \u0025\u0073\u0020\u0061\u006e\u0064\u0020\u0025\u0073",_bae ,_dgf );
_afa ,_deb ,_acbb ,_abf ,_eeef :=CreatePNGDiff (_bae ,_dgf );if _eeef !=nil &&_a .Is (_eeef ,ErrImageSizeNotMatch ){_bgg .Fatalf ("\u0045\u0072\u0072\u006fr\u0020\u006f\u006e\u0020\u0063\u0072\u0065\u0061\u0074\u0065 \u0050N\u0047\u0020\u0044\u0069\u0066\u0066\u003a \u0025\u0076",_eeef );
};if _afa {_bgg .Logf ("\u0049\u006d\u0061\u0067\u0065\u003a\u0020\u0025\u0073\u000a",_deb );_bgg .Logf ("D\u0069\u0066\u0066\u0020Pe\u0072c\u0065\u006e\u0074\u003a\u0020%\u0032\u002e\u0066\u0025\u0025\u000a",_acbb );_bgg .Logf ("\u0044i\u0066f\u0020\u0054\u006f\u0074\u0061\u006c\u003a\u0020\u0025\u0066\u000a",_abf );
_edd :=_df .Base (_deb );_dfad ,_fgf :=currentHashMap .Read (_edd );if _fgf &&(_dfad .DiffPercent < _acbb ||_dfad .DiffTotal < _abf ){_bgg .Logf ("\u004e\u0065\u0077\u0020\u0072\u0065\u0073\u0075\u006c\u0074\u0073\u0020\u0068\u0061\u0076\u0069\u006e\u0067 h\u0069g\u0068\u0065\u0072\u0020\u0064\u0069\u0066\u0066\u0065\u0072\u0065\u006ec\u0065\u0020\u0070\u0065\u0072\u0063\u0065\u006e\u0074\u003a\u0020\u0025\u0066\u0020\u0061\u006e\u0064 \u0074\u006f\u0074\u0061\u006c\u0020\u0025\u0066\u000a",_acbb ,_abf );
};_egeg ,_fef :=HashFile (_deb );_da .NoError (_bgg ,_fef );_bde :=_fae (_bgg ,_deb );if !_fgf ||_dfad .Value !=_egeg ||_dfad .ResultSize !=_bde ||_dfad .DiffPercent !=_acbb ||_dfad .DiffTotal !=_abf {_bbcg :=ReferenceEntry {Timestamp :_fadc .Now ().UTC ().Unix (),Value :_egeg ,ResultSize :_bde ,DiffPercent :_acbb ,DiffTotal :_abf };
currentHashMap .Write (_edd ,_bbcg );if _fef =refFile .Update (currentHashMap );_fef !=nil {_bgg .Logf ("\u0055\u0070\u0064\u0061\u0074\u0065\u0020\u0072\u0065\u0066\u0065\u0072\u0065\u006e\u0063e\u0020f\u0069\u006c\u0065\u0020\u0066\u0061\u0069\u006c\u0065\u0064\u003a\u0020\u0025\u0076",_fef );
};};};};continue ;};_bgg .Run (_be .Sprintf ("\u0070\u0061\u0067\u0065\u0025\u0064",_beec ),func (_ced *_gc .T ){_ced .Logf ("\u0043o\u006dp\u0061\u0072\u0069\u006e\u0067 \u0025\u0073 \u0076\u0073\u0020\u0025\u0073",_cead ,_bae );_gegd ,_aga :=ComparePNGFiles (_cead ,_bae );
if _ac .IsNotExist (_aga ){_ced .Fatal ("\u0069m\u0061g\u0065\u0020\u0066\u0069\u006ce\u0020\u006di\u0073\u0073\u0069\u006e\u0067");}else if !_gegd {_ced .Fatal ("\u0077\u0072\u006f\u006eg \u0070\u0061\u0067\u0065\u0020\u0072\u0065\u006e\u0064\u0065\u0072\u0065\u0064");
};});};});};func (_eea *ReferenceMap )Keys ()(_efb []string ){_efb =make ([]string ,len (_eea ._dc ));var _ccaa int ;for _cefd :=range _eea ._dc {_efb [_ccaa ]=_cefd ;_ccaa ++;};return _efb ;};func CompareGoldenZip (t *_gc .T ,expectedFn string ,got []byte ){_ddc :=_df .Join ("\u0074\u0065\u0073\u0074\u0064\u0061\u0074\u0061",expectedFn );
if *_fg {if _ga :=_ac .WriteFile (_ddc ,got ,0644);_ga !=nil {t .Fatal (_ga );};};CompareZip (t ,expectedFn ,got ,true );};